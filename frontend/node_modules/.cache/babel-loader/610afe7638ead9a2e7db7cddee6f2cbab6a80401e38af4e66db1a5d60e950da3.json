{"ast":null,"code":"import React,{useEffect,useState,useRef}from\"react\";import{Link,useNavigate,useParams}from\"react-router-dom\";import axios from\"axios\";import io from\"socket.io-client\";import{ArrowLeft}from\"lucide-react\";import moment from\"moment\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Chat(){const{groupId}=useParams();const backend=\"http://127.0.0.1:5100\";const[messages,setMessages]=useState([]);const[loading,setLoading]=useState(true);const[newMessage,setNewMessage]=useState(\"\");const[typing,setTyping]=useState(\"\");const[groupData,setGroupData]=useState({});const socket=useRef(null);const navigate=useNavigate();const currentUser=localStorage.getItem(\"username\");useEffect(()=>{const token=localStorage.getItem(\"token\");if(token){socket.current=io(backend,{auth:{token}});const fetchData=async()=>{try{const response=await axios.get(\"\".concat(backend,\"/group/\").concat(groupId,\"/messages\"),{headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token)}});if(response.status===200){setMessages(response.data.map(msg=>({message:msg.message,username:msg.sender.username,time:moment(msg.createdAt).format(\"hh:mm A\")})));}}catch(error){console.error(\"Error fetching messages:\",error);}finally{setLoading(false);}};fetchData();socket.current.on(\"message\",newMessage=>{newMessage.time=moment(newMessage.createdAt).format(\"hh:mm A\");setMessages(prevMessages=>[...prevMessages,newMessage]);});socket.current.on(\"type\",user=>setTyping(\"\".concat(user,\" is typing...\")));socket.current.on(\"stopTyping\",()=>setTyping(\"\"));return()=>socket.current.disconnect();}},[groupId]);const handleSendMessage=e=>{e.preventDefault();if(newMessage.trim()){const timestamp=moment().format(\"hh:mm A\");socket.current.emit(\"chatMessage\",{message:newMessage,sender:currentUser,group:groupId});setMessages(prevMessages=>[...prevMessages,{message:newMessage,username:currentUser,time:timestamp}]);setNewMessage(\"\");}};return/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-900 min-h-screen flex flex-col items-center justify-center p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-2xl bg-gray-800 p-5 rounded-lg shadow-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-1\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(-1),className:\"text-gray-400 hover:text-white\",children:/*#__PURE__*/_jsx(ArrowLeft,{size:24})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-bold text-white\",children:\"Group Chat\"}),/*#__PURE__*/_jsx(Link,{to:\"/dashboard\",className:\"text-red-400 hover:underline\",children:\"Leave\"})]}),typing&&/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-300 mb-2\",children:typing}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-y-auto max-h-[500px] space-y-3 p-2 bg-gray-700 rounded-lg\",children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-center\",children:\"Loading messages...\"}):messages.length>0?messages.map((msg,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(msg.username===currentUser?\"justify-end\":\"justify-start\"),children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 rounded-lg max-w-xs break-words \".concat(msg.username===currentUser?\"bg-blue-600 text-white\":\"bg-gray-300 text-black\"),children:[msg.username!==currentUser&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-semibold text-gray-700\",children:msg.username}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm\",children:msg.message}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500 mt-1 text-right\",children:msg.time})]})},index)):/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-center\",children:\"No messages yet\"})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,className:\"mt-4 flex gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newMessage,onChange:e=>setNewMessage(e.target.value),className:\"flex-1 p-2 rounded-lg border-none focus:outline-none text-black\",placeholder:\"Type a message...\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-700\",children:\"Send\"})]})]})});}","map":{"version":3,"names":["React","useEffect","useState","useRef","Link","useNavigate","useParams","axios","io","ArrowLeft","moment","jsx","_jsx","jsxs","_jsxs","Chat","groupId","backend","messages","setMessages","loading","setLoading","newMessage","setNewMessage","typing","setTyping","groupData","setGroupData","socket","navigate","currentUser","localStorage","getItem","token","current","auth","fetchData","response","get","concat","headers","Authorization","status","data","map","msg","message","username","sender","time","createdAt","format","error","console","on","prevMessages","user","disconnect","handleSendMessage","e","preventDefault","trim","timestamp","emit","group","className","children","onClick","size","to","length","index","onSubmit","type","value","onChange","target","placeholder"],"sources":["/Users/shaghayeghzarei/Documents/School/Semester 6/Fullstack/101274382_lab_test1_chatapp/101274382_lab_test1_chatapp/frontend/src/screens/chat.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport { Link, useNavigate, useParams } from \"react-router-dom\";\nimport axios from \"axios\";\nimport io from \"socket.io-client\";\nimport { ArrowLeft } from \"lucide-react\";\nimport moment from \"moment\";\n\nexport default function Chat() {\n  const { groupId } = useParams();\n  const backend = \"http://127.0.0.1:5100\";\n  const [messages, setMessages] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [typing, setTyping] = useState(\"\");\n  const [groupData, setGroupData] = useState({});\n  const socket = useRef(null);\n  const navigate = useNavigate();\n  const currentUser = localStorage.getItem(\"username\");\n\n  useEffect(() => {\n    const token = localStorage.getItem(\"token\");\n    if (token) {\n      socket.current = io(backend, {\n        auth: { token },\n      });\n\n      const fetchData = async () => {\n        try {\n          const response = await axios.get(`${backend}/group/${groupId}/messages`, {\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: `Bearer ${token}`,\n            },\n          });\n          if (response.status === 200) {\n            setMessages(response.data.map((msg) => ({ \n              message: msg.message, \n              username: msg.sender.username, \n              time: moment(msg.createdAt).format(\"hh:mm A\") \n            })));\n          }\n        } catch (error) {\n          console.error(\"Error fetching messages:\", error);\n        } finally {\n          setLoading(false);\n        }\n      };\n      fetchData();\n\n      socket.current.on(\"message\", (newMessage) => {\n        newMessage.time = moment(newMessage.createdAt).format(\"hh:mm A\");\n        setMessages((prevMessages) => [...prevMessages, newMessage]);\n      });\n      socket.current.on(\"type\", (user) => setTyping(`${user} is typing...`));\n      socket.current.on(\"stopTyping\", () => setTyping(\"\"));\n\n      return () => socket.current.disconnect();\n    }\n  }, [groupId]);\n\n  const handleSendMessage = (e) => {\n    e.preventDefault();\n    if (newMessage.trim()) {\n      const timestamp = moment().format(\"hh:mm A\");\n      socket.current.emit(\"chatMessage\", { message: newMessage, sender: currentUser, group: groupId });\n      setMessages((prevMessages) => [...prevMessages, { message: newMessage, username: currentUser, time: timestamp }]);\n      setNewMessage(\"\");\n    }\n  };\n  \n\n  return (\n    <div className=\"bg-gray-900 min-h-screen flex flex-col items-center justify-center p-4\">\n      <div className=\"w-full max-w-2xl bg-gray-800 p-5 rounded-lg shadow-lg\">\n        <div className=\"flex justify-between items-center mb-1\">\n          <button onClick={() => navigate(-1)} className=\"text-gray-400 hover:text-white\">\n            <ArrowLeft size={24} />\n          </button>\n          <h1 className=\"text-xl font-bold text-white\">Group Chat</h1>\n          <Link to=\"/dashboard\" className=\"text-red-400 hover:underline\">Leave</Link>\n        </div>\n        {typing && <div className=\"text-sm text-gray-300 mb-2\">{typing}</div>}\n        <div className=\"overflow-y-auto max-h-[500px] space-y-3 p-2 bg-gray-700 rounded-lg\">\n          {loading ? (\n            <div className=\"text-gray-400 text-center\">Loading messages...</div>\n          ) : messages.length > 0 ? (\n            messages.map((msg, index) => (\n              <div\n                key={index}\n                className={`flex ${msg.username === currentUser ? \"justify-end\" : \"justify-start\"}`}\n              >\n                <div className={`p-3 rounded-lg max-w-xs break-words ${msg.username === currentUser ? \"bg-blue-600 text-white\" : \"bg-gray-300 text-black\"}`}>\n                  {msg.username !== currentUser && <div className=\"text-xs font-semibold text-gray-700\">{msg.username}</div>}\n                  <div className=\"text-sm\">{msg.message}</div>\n                  <div className=\"text-xs text-gray-500 mt-1 text-right\">{msg.time}</div>\n                </div>\n              </div>\n            ))\n          ) : (\n            <div className=\"text-gray-400 text-center\">No messages yet</div>\n          )}\n        </div>\n        <form onSubmit={handleSendMessage} className=\"mt-4 flex gap-2\">\n          <input\n            type=\"text\"\n            value={newMessage}\n            onChange={(e) => setNewMessage(e.target.value)}\n            className=\"flex-1 p-2 rounded-lg border-none focus:outline-none text-black\"\n            placeholder=\"Type a message...\"\n          />\n          <button type=\"submit\" className=\"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-700\">Send</button>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}